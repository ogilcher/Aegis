name: Security

on:
    push:
        branches: ["main"]
    pull_request:
    schedule:
        - cron: "0 9 * * 1" # Mondays 09:00 UTC (weekly scan)
        
permissions:
    contents: read
    
concurrency:
    group: security-${{ github.ref }}
    cancel-in-progress: true
    
jobs:
    dependency-review:
        if: github.event_name == "pull_request"
        runs-on: ubuntu-latest
        permissions:
            contents: read
            pull_requests: write
        steps:
            - name: Checkout
            uses: actions/checkout@v4
            - name: Dependency review
            uses: actions/dependency-review-action@v4
            
    codeql:
        name: CodeQL
        runs-on: ubuntu-latest
        permissions:
            security-events: write
            contents: read
            
        strategy:
            fail-fast: false
            matrix:
                language: ["python"]
                
        steps:
            - name: Checkout
            uses: actions/checkout@v4
            
            - name: Initialize CodeQL
            uses: github/codeql-action/init@v3
            with:
                languages: ${{ matrix.language }}
                
            - name: Autobuild
            uses: github/codeql-action/autobuild@v3
            
            - name: Analyze
            uses: github/codeql-action/analyze@v3
