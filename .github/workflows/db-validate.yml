name: DB Validate (Supabase)

on:
    pull_request:
        paths:
            - "infra/**"
            - "supabase/**"
            - ".github/workflows/db-validate.yml"
    push:
        branches: ["main"]
        paths:
            - "infra/**"
            - "supabase/**"
            - ".github/workflows/db-validate.yml"
            
concurrency:
    group: db-validate-${{ github.ref }}
    cancel-in-progress: true
    
jobs:
    validate:
        runs-on: ubuntu-latest
        timeout-minutes: 20
        
        steps:
            - name: Checkout
            uses: actions/checkout@v4
            
            - name: Setup Supabase CLI
            uses: supabase/setup-cli@v1
            with:
                version: latest
                
            - name: Start Supabase (local)
            run: supabase Start
            
            - name: Stop Supabase
            if: always()
            run: supabase stop
